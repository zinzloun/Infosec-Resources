# Securing Microsoft 365 
This document describes the recommended security architecture and configuration steps to secure our Microsoft 365 tenant while integrating with on-prem Active Directory (AD).

---

## 1. Identity Integration (Hybrid AD)

We will integrate on-prem Active Directory with Azure AD using **Azure AD Connect**.

### Steps:
1. **Prepare AD**:
   - Ensure all users have a valid, routable UPN suffix (e.g. `@company.com`).
   - Remove duplicate or stale accounts.
2. **Install Azure AD Connect**:
   - Deploy on a Windows Server (not a DC but domain-joined).
   - Choose **Password Hash Sync (PHS)** for simplicity and reliability.
   - Enable **Password Writeback** if self-service password reset is required.
3. **Verify Synchronization**:
   - Run `Get-ADSyncScheduler` to confirm sync frequency.
   - Validate that users appear in **Azure AD > Users**.

---

## 2. Multi-Factor Authentication (MFA)

We will enforce MFA using **Conditional Access Policies**.

### Steps:
1. In **Azure AD > Security > Conditional Access**:
   - **Block legacy authentication**: deny access from clients using basic auth (POP, IMAP, SMTP).
   - **Require MFA for all users**:
     - Assign to `All Users` (exclude 2 break-glass accounts).
     - Apply to `All cloud apps`.
     - Grant access only if MFA is satisfied.
   - **Require MFA for risky sign-ins** (via Identity Protection).
2. **User Experience**:
   - Default method: Microsoft Authenticator app.
   - Allow backup methods (SMS, voice) for flexibility.

---

## 3. Strict RBAC (Role-Based Access Control)

We will enforce the principle of **least privilege** by assigning roles based on function.

### Steps:
1. In **Azure AD > Roles and administrators**:
   - Remove permanent Global Admins (except break-glass accounts).
   - Assign only required roles:
     - **Helpdesk** â†’ Password Administrator
     - **Exchange team** â†’ Exchange Administrator
     - **Security team** â†’ Security Reader / Security Operator
2. **Access Reviews** (Azure AD Premium P2 feature):
   - Schedule periodic access reviews for high-privilege roles.
   - Require justification for continued access.

---

## 4. Privileged Identity Management (PIM)

We will implement **Just-in-Time (JIT)** administrative access.

### Steps:
1. Go to **Azure AD > Privileged Identity Management (PIM)**.
2. Configure roles as **Eligible** (not permanent).
3. Require:
   - **MFA at activation**.
   - **Approval workflow** for high-impact roles (e.g. Global Admin).
   - **Justification** at role activation.
4. Set **activation duration** (e.g. 4 hours max).
5. Enable **notifications** and review **audit logs** for each activation.

**Example Policy**:
- Global Admin:
  - Eligible
  - MFA required
  - Approval required
  - Max duration: 4 hours

---

## 5. SIEM Integration (Security Onion)

We will centralize Microsoft 365 and Azure AD logs into **Security Onion** for monitoring and detection.

### Log Sources:
- **Azure AD**: sign-ins, audit logs, risky sign-ins, PIM activations.
- **Exchange Online**: mailbox audit, mail transport logs.
- **SharePoint/OneDrive**: file activity, sharing logs.
- **Defender for O365**: threat alerts and detections.

### Integration Options:
1. **Office 365 Management Activity API**:
   - Deploy a collector using o365beat
   - Forward logs via Syslog to Security Onion.
2. **Azure Monitor â†’ Event Hub â†’ Logstash â†’ Security Onion**:
   - Stream Azure AD sign-in and audit logs to Event Hub.
   - Use Logstash to pull from Event Hub and forward to Security Onion.
3. **Direct API Scripts**:
   - Use PowerShell or Python to pull logs from Graph API / Defender API.
   - Forward to syslog.

---

## 6. Security Baseline Checklist

- [x] Azure AD Connect configured with PHS  
- [x] MFA enforced via Conditional Access  
- [x] Legacy authentication blocked  
- [x] RBAC applied (no standing Global Admins)  
- [x] PIM enabled for privileged roles  
- [x] SIEM integration with Security Onion in place  
- [x] Break-glass accounts documented and tested  

---

## 7. References

- [Azure AD Connect](https://learn.microsoft.com/en-us/azure/active-directory/hybrid/whatis-azure-ad-connect)
- [Conditional Access](https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/overview)
- [Privileged Identity Management](https://learn.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure)
- [Office 365 Management Activity API](https://learn.microsoft.com/en-us/office/office-365-management-api/office-365-management-activity-api-reference)
- [Security Onion](https://securityonion.net/)

# Microsoft 365 â€“ Shared Responsibility Model

This section outlines the division of responsibilities between **Microsoft** and the **Customer** for Microsoft 365, focusing on patch management, backup, retention, and incident response.

---

## ðŸ“¦ Patch Management

| Responsibility | Microsoft | Customer |
|----------------|-----------|----------|
| Service Infrastructure | Microsoft is responsible for patching and updating the Microsoft 365 service infrastructure (datacenters, servers, hypervisors, service apps). | Customer is responsible for patching on-prem systems (e.g. hybrid Exchange, AD servers) and all client endpoints. |
| Zero-day and Critical Fixes | Microsoft deploys fixes/mitigations for vulnerabilities in Microsoft 365 services. | Customer must apply updates to local software, devices, and third-party applications. |

---

## ðŸ’¾ Backup and Data Protection

| Responsibility | Microsoft | Customer |
|----------------|-----------|----------|
| Service Resilience | Microsoft replicates data across datacenters for high availability and disaster recovery. | Customer is responsible for protecting data against accidental deletion, malicious deletion, or retention needs beyond Microsoft defaults. |
| Backup Guarantee | Microsoft **does not** provide a traditional point-in-time backup SLA. | Customer must implement additional backup/archival solutions if business or regulatory requirements demand longer RPO/RTO. |

---

## ðŸ—‚ Retention Policies

| Responsibility | Microsoft | Customer |
|----------------|-----------|----------|
| Tools | Microsoft provides retention features (retention policies, retention labels, Preservation Hold, Litigation Hold). | Customer must configure policies according to business/compliance needs. |
| Defaults | Microsoft provides limited default retention (e.g. recycle bin, soft delete). | Customer must ensure policies are applied, tested, and aligned with regulatory obligations. |

---

## ðŸš¨ Incident Response

| Responsibility | Microsoft | Customer |
|----------------|-----------|----------|
| Service-side IR | Microsoft monitors and secures Microsoft 365 infrastructure 24/7, publishes security bulletins, and provides global threat intelligence. | Customer is responsible for monitoring tenant activity, responding to alerts, and investigating suspicious behavior using logs, SIEM, and security tools. |
| Support | Microsoft provides incident support under service agreements and offers **Microsoft Incident Response** as a paid service. | Customer must escalate incidents, coordinate with Microsoft when needed, and implement internal response procedures. |

---

## âœ… Key Takeaways

- Microsoft ensures **availability and security of the Microsoft 365 platform**.  
- Customers must secure **identity, access, endpoint devices, configurations, and data governance**.  
- Backup, retention, and regulatory compliance **remain customer responsibilities** unless explicitly covered by additional Microsoft services or third-party solutions.  
- For privileged access and tenant governance, customers should enforce **MFA, RBAC, PIM, and SIEM integration**.  

---

## ðŸ”— References

- [Microsoft 365 Shared Responsibility Model â€“ Backup](https://techcommunity.microsoft.com/discussions/microsoft-365/m365-backup-responsibility/3765700)  
- [Azure Shared Responsibility Model](https://learn.microsoft.com/en-us/azure/reliability/concept-shared-responsibility)  
- [Microsoft Retention and Records Management](https://learn.microsoft.com/en-us/microsoft-365/compliance/retention?view=o365-worldwide)  
- [Microsoft Incident Response Services](https://www.microsoft.com/en-us/security/blog/2023/08/15/how-the-microsoft-incident-response-team-helps-customers-remediate-threats/)  

